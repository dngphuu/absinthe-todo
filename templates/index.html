<!doctype html>
<html lang="en">
  <!-- Head section with meta tags, CSS and font imports -->
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      type="image/x-icon"
      href="{{ url_for('static', filename='media_resources/favicon.ico') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/output.css') }}"
    />
    <title>Absinthe Todo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap"
      rel="stylesheet"
    />
  </head>

  <body class="bg-[#fafafa] antialiased">
    <!-- Header Section: Contains app logo, title and user info -->
    <header
      role="banner"
      class="flex items-center justify-between bg-[#3d72fe] shadow-xl"
    >
      <div>
        <!-- Logo and App name -->
        <h1
          class="flex items-center text-nowrap p-3 px-5 font-rubik text-2xl font-medium text-white"
        >
          <img
            src="{{ url_for('static', filename='media_resources/logopng.png') }}"
            alt="App logo"
            class="mr-2 inline-block h-10"
          />
          Absinthe Todo
        </h1>
      </div>

      <!-- Updated User Info section -->
      <div id="user-info">
        <button
          class="mr-2 flex items-center transition-all duration-300 focus:outline-none active:scale-110 active:opacity-80"
        >
          <span class="mr-3 font-roboto text-sm text-white">
            {{ user.name if user and user.name else 'User' }}
          </span>
          <img
            src="{{ user.picture if user and user.picture else url_for('static', filename='media_resources/default-avatar.png') }}"
            alt="User Avatar"
            id="user-avatar"
            class="hidden h-10 w-10 rounded-full sm:block"
          />
        </button>
      </div>
    </header>

    <!-- Add error message container -->
    <div
      id="error-message"
      class="fixed right-4 top-4 hidden rounded-md bg-red-100 p-4 text-red-900"
      role="alert"
    >
      <!-- Error message content will be dynamically inserted -->
    </div>

    <!-- User Menu: Logout option -->
    <div
      id="logout-menu"
      class="absolute right-3 mt-2 hidden -translate-y-4 transform cursor-pointer rounded-md border-2 bg-white font-rubik opacity-0 shadow-sm transition-all duration-150"
    >
      <ul>
        <li class="text-md p-2 text-sm font-medium text-black">
          <a href="{{ url_for('logout') }}" class="flex items-center gap-2">
            <svg
              class="h-[16px] w-[16px] text-black"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              width="26"
              height="26"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path d="M14 19V5h4a1 1 0 0 1 1 1v11h1a1 1 0 0 1 0 2h-6Z" />
              <path
                fill-rule="evenodd"
                d="M12 4.571a1 1 0 0 0-1.275-.961l-5 1.428A1 1 0 0 0 5 6v11H4a1 1 0 0 0 0 2h1.86l4.865 1.39A1 1 0 0 0 12 19.43V4.57ZM10 11a1 1 0 0 1 1 1v.5a1 1 0 0 1-2 0V12a1 1 0 0 1 1-1Z"
                clip-rule="evenodd"
              />
            </svg>
            LOG OUT
          </a>
        </li>
      </ul>
    </div>

    <!-- Main Content: Task Management Interface -->
    <main
      role="main"
      class="mx-auto mt-24 max-w-3xl rounded-md border bg-white font-rubik shadow-xl"
    >
      <!-- Task Input Form -->
      <div class="task-input-container">
        <form id="add-task-form" class="relative">
          <input
            type="text"
            placeholder="‚ú® Add a new task..."
            class="task-input"
            id="task-input"
          />
          <button
            type="submit"
            title="Add task"
            id="add-task-btn"
            class="task-submit-btn"
          >
            <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path 
                d="M12 5l7 7-7 7M5 12h14" 
                stroke-width="2" 
                stroke-linecap="round" 
                stroke-linejoin="round"
              />
            </svg>
          </button>
        </form>
      </div>

      <!-- Task Actions Menu -->
      <section class="section-header">
        <div class="flex items-center space-x-4">
          <!-- Utilities Menu -->
          <div class="flex items-center space-x-2">
            <button
              id="magic-sort-button"
              class="flex items-center space-x-2 rounded-md bg-[#3d72fe] px-3 py-1.5 text-white transition-all duration-300 hover:bg-blue-600 hover:shadow-md active:scale-95 disabled:opacity-50"
            >
              <svg class="h-4 w-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"/>
              </svg>
              <span class="text-xs">Magic Sort</span>
            </button>

            <button
              id="view-toggle-button"
              disabled
              class="flex items-center space-x-2 rounded-md bg-gray-100 px-3 py-1.5 text-gray-400 transition-all duration-300 hover:bg-gray-200 active:scale-95 disabled:cursor-not-allowed disabled:hover:bg-gray-100"
            >
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
              </svg>
              <span class="text-xs">View</span>
            </button>
          </div>
        </div>
      </section>

      <!-- Task List Container -->
      <div id="task-container" class="mx-6 mb-3 mt-1">
        <!-- List View (default) -->
        <ul id="task-list" role="list" aria-label="Task list" class="view-list space-y-2">
          {% for task in tasks %}
          <li
            data-id="{{ task.id }}"
            class="task-item group relative flex w-full items-center justify-between rounded-lg border border-gray-100 p-2 transition-all duration-200 hover:translate-x-1 hover:border-gray-200 hover:shadow-sm"
          >
            <div class="flex items-center flex-1">
              <input
                type="checkbox"
                class="task-checkbox mr-4 h-5 w-5 cursor-pointer rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                {% if task.completed %}checked{% endif %}
              />
              <input
                type="text"
                value="{{ task.content }}"
                class="task-content flex-1 bg-transparent px-1 outline-none transition-all duration-200 focus:bg-gray-50 rounded-md focus:px-2"
              />
              <span class="quadrant-indicator ml-2 hidden group-hover:inline-flex items-center text-sm"></span>
            </div>
            <div class="flex items-center space-x-1">
              <button
                class="task-delete p-2 text-gray-400 transition-all duration-300 hover:text-red-500 hover:rounded-full hover:bg-red-50"
                title="Delete task"
                type="button"
              >
                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </button>
            </div>
          </li>
          {% endfor %}
        </ul>

        <!-- Matrix View (hidden by default) -->
        <div id="matrix-view" class="view-matrix hidden">
          <div class="grid grid-cols-2 gap-4">
            <!-- Q1: Urgent & Important -->
            <div class="quadrant quadrant-q1">
              <h3 class="mb-4 flex items-center gap-2 font-medium text-[#dc2626]">
                <span class="quadrant-indicator quadrant-indicator-q1">
                  <span class="mr-2 text-lg">‚ö°</span>
                  Urgent & Important
                </span>
              </h3>
              <ul class="q1-tasks space-y-2"></ul>
            </div>
            
            <!-- Q2: Not Urgent & Important -->
            <div class="quadrant quadrant-q2">
              <h3 class="mb-4 flex items-center gap-2 font-medium text-[#2563eb]">
                <span class="quadrant-indicator quadrant-indicator-q2">
                  <span class="mr-2 text-lg">üéØ</span>
                  Not Urgent & Important
                </span>
              </h3>
              <ul class="q2-tasks space-y-2"></ul>
            </div>
            
            <!-- Q3: Urgent & Not Important -->
            <div class="quadrant quadrant-q3">
              <h3 class="mb-4 flex items-center gap-2 font-medium text-[#f59e0b]">
                <span class="quadrant-indicator quadrant-indicator-q3">
                  <span class="mr-2 text-lg">‚è≥</span>
                  Urgent & Not Important
                </span>
              </h3>
              <ul class="q3-tasks space-y-2"></ul>
            </div>
            
            <!-- Q4: Not Urgent & Not Important -->
            <div class="quadrant quadrant-q4">
              <h3 class="mb-4 flex items-center gap-2 font-medium text-[#71717a]">
                <span class="quadrant-indicator quadrant-indicator-q4">
                  <span class="mr-2 text-lg">‚ûñ</span>
                  Not Urgent & Not Important
                </span>
              </h3>
              <ul class="q4-tasks space-y-2"></ul>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Floating Sync Button -->
    <a
      id="sync-button"
      role="button"
      aria-label="Synchronize tasks"
      class="fixed bottom-6 right-6 flex items-center justify-center space-x-2 rounded-md bg-[#3d72fe] px-6 py-3 text-white transition-all duration-300 hover:bg-blue-600 active:scale-95 disabled:opacity-50"
    >
      <svg
        class="h-6 w-6 text-white"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        fill="none"
        viewBox="0 0 24 24"
      >
        <path
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M17.651 7.65a7.131 7.131 0 0 0-12.68 3.15M18.001 4v4h-4m-7.652 8.35a7.13 7.13 0 0 0 12.68-3.15M6 20v-4h4"
        />
      </svg>
      <span class="font-rubik text-sm text-white">Sync tasks</span>
    </a>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</html>
